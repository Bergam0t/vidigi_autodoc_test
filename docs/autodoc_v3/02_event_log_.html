<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>event_log_ – Vidigi - Auto Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5d2e30ad26079c1dae90a1fd11eba2b9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../autodoc_v3/index.html">Beginner Friendly + 1980s References</a></li><li class="breadcrumb-item"><a href="../autodoc_v3/02_event_log_.html">Chapter 2: Log Everything! Like K.I.T.T.’s Mission Recorder</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Vidigi - Auto Documentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Version 1 - Beginner-Friendly</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial: vidigi</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_animation_facade_animate_activity_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Animation Facade (<code>animate_activity_log</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_event_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Event Log</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_layout_configuration_event_position_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Layout Configuration (<code>event_position_df</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_simpy_resource_enhancement_customresource_store_populate_store_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: Simpy Resource Enhancement (<code>CustomResource</code>, <code>Store</code>, <code>populate_store</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_snapshot_preparation_reshape_for_animations_generate_animation_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Snapshot Preparation (`reshape_for_animations` &amp; `generate_animation_df`)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_animation_generation_generate_animation_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6: Animation Generation (<code>generate_animation</code>)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Version 2 - Intermediate Programmer</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial: vidigi</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/01_animation_facade_animate_activity_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Animation Facade (<code>animate_activity_log</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/02_event_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Event Log</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/03_layout_configuration_event_position_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Layout Configuration (<code>event_position_df</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/04_simpy_resource_enhancement_customresource_store_populate_store_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: Simpy Resource Enhancement (<code>CustomResource</code>, <code>Store</code>, <code>populate_store</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/05_snapshot_preparation_reshape_for_animations_generate_animation_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Snapshot Preparation (`reshape_for_animations` &amp; `generate_animation_df`)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/06_animation_generation_generate_animation_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6: Animation Generation (<code>generate_animation</code>)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Beginner Friendly + 1980s References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial: vidigi</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/01_animation_facade_animate_activity_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Great Scott! Making Animations Easy with <code>animate_activity_log</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/02_event_log_.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chapter 2: Log Everything! Like K.I.T.T.’s Mission Recorder</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/03_layout_configuration_event_position_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Where Am I? Mapping the Grid with <code>event_position_df</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/04_simpy_resource_enhancement_customresource_store_populate_store_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: More Input! Giving Your Resources an Upgrade (<code>CustomResource</code>, <code>Store</code>, <code>populate_store</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/05_snapshot_preparation_reshape_for_animations_generate_animation_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Prepare for Snapshots, McFly! (`reshape_for_animations` &amp; `generate_animation_df`)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/06_animation_generation_generate_animation_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6: Action! Making the Movie with <code>generate_animation</code></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chapter-2-log-everything-like-k.i.t.t.s-mission-recorder" id="toc-chapter-2-log-everything-like-k.i.t.t.s-mission-recorder" class="nav-link active" data-scroll-target="#chapter-2-log-everything-like-k.i.t.t.s-mission-recorder">Chapter 2: Log Everything! Like K.I.T.T.’s Mission Recorder</a>
  <ul class="collapse">
  <li><a href="#the-mission-recording-the-action" id="toc-the-mission-recording-the-action" class="nav-link" data-scroll-target="#the-mission-recording-the-action">The Mission: Recording the Action</a></li>
  <li><a href="#the-blueprint-anatomy-of-an-event-log" id="toc-the-blueprint-anatomy-of-an-event-log" class="nav-link" data-scroll-target="#the-blueprint-anatomy-of-an-event-log">The Blueprint: Anatomy of an Event Log</a></li>
  <li><a href="#creating-your-own-log-lets-get-coding" id="toc-creating-your-own-log-lets-get-coding" class="nav-link" data-scroll-target="#creating-your-own-log-lets-get-coding">Creating Your Own Log: Let’s Get Coding!</a></li>
  <li><a href="#under-the-hood-how-vidigi-uses-the-log" id="toc-under-the-hood-how-vidigi-uses-the-log" class="nav-link" data-scroll-target="#under-the-hood-how-vidigi-uses-the-log">Under the Hood: How <code>vidigi</code> Uses the Log</a></li>
  <li><a href="#conclusion-fueling-the-flux-capacitor" id="toc-conclusion-fueling-the-flux-capacitor" class="nav-link" data-scroll-target="#conclusion-fueling-the-flux-capacitor">Conclusion: Fueling the Flux Capacitor!</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../autodoc_v3/index.html">Beginner Friendly + 1980s References</a></li><li class="breadcrumb-item"><a href="../autodoc_v3/02_event_log_.html">Chapter 2: Log Everything! Like K.I.T.T.’s Mission Recorder</a></li></ol></nav></header>




<section id="chapter-2-log-everything-like-k.i.t.t.s-mission-recorder" class="level1">
<h1>Chapter 2: Log Everything! Like K.I.T.T.’s Mission Recorder</h1>
<p>Great Scott! In <a href="../autodoc_v3/01_animation_facade_animate_activity_log_.html">Chapter 1: Great Scott! Making Animations Easy with <code>animate_activity_log</code></a>, we met <code>animate_activity_log</code>, our trusty DeLorean control panel for creating process animations. We saw how it takes the key ingredients and produces a visual masterpiece. But what’s the <em>most</em> crucial ingredient? It’s the script, the minute-by-minute breakdown of the action – the <strong>Event Log</strong>.</p>
<p>Imagine trying to understand what K.I.T.T. did all day just by looking at his parking spot. Impossible! You need his internal logs, telling you <em>when</em> he scanned for trouble, <em>when</em> he deployed the smokescreen, and <em>when</em> he used Turbo Boost. That’s exactly what the Event Log does for <code>vidigi</code>.</p>
<section id="the-mission-recording-the-action" class="level2">
<h2 class="anchored" data-anchor-id="the-mission-recording-the-action">The Mission: Recording the Action</h2>
<p>Think back to our clinic simulation. We need to tell <code>vidigi</code> precisely when each patient arrived, when they started waiting, when they began treatment (and with which nurse!), when they finished, and when they left. It’s like writing a detailed diary entry for every single patient (or maybe for every droid like R2-D2 on a mission).</p>
<p>Without this detailed log, <code>animate_activity_log</code> is like a director with no script – it doesn’t know what story to tell! The Event Log provides the raw sequence of events and times that <code>vidigi</code> needs to reconstruct the system’s dynamics visually.</p>
</section>
<section id="the-blueprint-anatomy-of-an-event-log" class="level2">
<h2 class="anchored" data-anchor-id="the-blueprint-anatomy-of-an-event-log">The Blueprint: Anatomy of an Event Log</h2>
<p>So, what does this “diary” or “log file” look like? It’s simply a table, usually a pandas DataFrame, with specific columns that <code>vidigi</code> understands. Think of it as the standard report format requested by Devon Miles at FLAG.</p>
<p>Here are the essential columns:</p>
<ol type="1">
<li><strong><code>patient</code>:</strong> This is the unique identifier for the entity moving through the system. It could be a patient ID, a serial number for a component (like Johnny 5!), or even a callsign (like ‘Maverick’ or ‘Goose’). Each row in the log belongs to one specific <code>patient</code>.</li>
<li><strong><code>event_type</code>:</strong> This tells <code>vidigi</code> the <em>kind</em> of activity being recorded. It’s like classifying K.I.T.T.’s actions: ‘Scanning’, ‘Driving’, ‘Special Maneuver’. <code>vidigi</code> recognizes specific types:
<ul>
<li><code>arrival_departure</code>: Marks when the entity enters or leaves the system. These are the opening and closing scenes!</li>
<li><code>queue</code>: Indicates the entity has started waiting for something (like waiting for E.T. to phone home, or waiting for a treatment cubicle).</li>
<li><code>resource_use</code>: Signals that the entity has started using a specific resource (like a nurse seeing a patient, or Ripley getting into a specific Power Loader).</li>
<li><code>resource_use_end</code>: Signals that the entity has <em>finished</em> using that specific resource.</li>
</ul></li>
<li><strong><code>event</code>:</strong> This is a more specific <em>name</em> for the event that occurred. You get to define most of these! Examples: ‘Arrival_Clinic’, ‘Wait_for_Nurse’, ‘Start_Treatment’, ‘End_Treatment’, ‘Depart_Clinic’.
<ul>
<li><strong>Crucial Note:</strong> For <code>arrival_departure</code> event types, <code>vidigi</code> specifically expects the <code>event</code> names to be exactly <code>'arrival'</code> and <code>'depart'</code>. Don’t get creative here, or the system won’t know when things start and end! Think of these as the fixed “Power On” and “Shutdown” commands.</li>
</ul></li>
<li><strong><code>time</code>:</strong> This is the timestamp when the event occurred, measured in your simulation’s time units (e.g., minutes, hours, parsecs!). It’s the “when” for every “what”.</li>
</ol>
<p><strong>Bonus Column for Resources:</strong></p>
<ol start="5" type="1">
<li><strong><code>resource_id</code> (Required for <code>resource_use</code> and <code>resource_use_end</code>):</strong> When an entity uses a resource (like one of the Ghostbusters using a specific Proton Pack), we need to know <em>which</em> one. This column holds the unique ID of the specific resource unit being used or released. This is essential for tracking which specific nurse (Nurse Jackie 1, Nurse Jackie 2, etc.) is busy. We’ll talk more about how these IDs come from the <a href="../autodoc_v3/04_simpy_resource_enhancement_customresource_store_populate_store_.html">Simpy Resource Enhancement (<code>CustomResource</code>, <code>Store</code>, <code>populate_store</code>)</a>.</li>
</ol>
</section>
<section id="creating-your-own-log-lets-get-coding" class="level2">
<h2 class="anchored" data-anchor-id="creating-your-own-log-lets-get-coding">Creating Your Own Log: Let’s Get Coding!</h2>
<p>Okay, let’s build an Event Log for our Top Gun trainees, Maverick and Goose. We’ll use <code>pandas</code>, the go-to library for data tables in Python.</p>
<p>First, make sure you have pandas imported:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, let’s create the data as a list of dictionaries. Each dictionary represents one event (one row in our log):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the events for Maverick and Goose</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>event_data <span class="op">=</span> [</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Maverick's Journey</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Maverick'</span>, <span class="st">'event_type'</span>: <span class="st">'arrival_departure'</span>, <span class="st">'event'</span>: <span class="st">'arrival'</span>, <span class="st">'time'</span>: <span class="dv">0</span>},</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Maverick'</span>, <span class="st">'event_type'</span>: <span class="st">'queue'</span>, <span class="st">'event'</span>: <span class="st">'wait_for_simulator'</span>, <span class="st">'time'</span>: <span class="dv">1</span>}, <span class="co"># Starts waiting</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Maverick'</span>, <span class="st">'event_type'</span>: <span class="st">'resource_use'</span>, <span class="st">'event'</span>: <span class="st">'start_simulator'</span>, <span class="st">'time'</span>: <span class="dv">10</span>, <span class="st">'resource_id'</span>: <span class="st">'Sim_1'</span>}, <span class="co"># Got Simulator 1</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Maverick'</span>, <span class="st">'event_type'</span>: <span class="st">'resource_use_end'</span>, <span class="st">'event'</span>: <span class="st">'end_simulator'</span>, <span class="st">'time'</span>: <span class="dv">50</span>, <span class="st">'resource_id'</span>: <span class="st">'Sim_1'</span>}, <span class="co"># Finished Sim 1</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Maverick'</span>, <span class="st">'event_type'</span>: <span class="st">'arrival_departure'</span>, <span class="st">'event'</span>: <span class="st">'depart'</span>, <span class="st">'time'</span>: <span class="dv">55</span>},</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Goose's Journey</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Goose'</span>, <span class="st">'event_type'</span>: <span class="st">'arrival_departure'</span>, <span class="st">'event'</span>: <span class="st">'arrival'</span>, <span class="st">'time'</span>: <span class="dv">5</span>},</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Goose'</span>, <span class="st">'event_type'</span>: <span class="st">'queue'</span>, <span class="st">'event'</span>: <span class="st">'wait_for_simulator'</span>, <span class="st">'time'</span>: <span class="dv">6</span>}, <span class="co"># Starts waiting</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Goose'</span>, <span class="st">'event_type'</span>: <span class="st">'resource_use'</span>, <span class="st">'event'</span>: <span class="st">'start_simulator'</span>, <span class="st">'time'</span>: <span class="dv">15</span>, <span class="st">'resource_id'</span>: <span class="st">'Sim_2'</span>}, <span class="co"># Got Simulator 2</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Goose'</span>, <span class="st">'event_type'</span>: <span class="st">'resource_use_end'</span>, <span class="st">'event'</span>: <span class="st">'end_simulator'</span>, <span class="st">'time'</span>: <span class="dv">65</span>, <span class="st">'resource_id'</span>: <span class="st">'Sim_2'</span>}, <span class="co"># Finished Sim 2</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'patient'</span>: <span class="st">'Goose'</span>, <span class="st">'event_type'</span>: <span class="st">'arrival_departure'</span>, <span class="st">'event'</span>: <span class="st">'depart'</span>, <span class="st">'time'</span>: <span class="dv">70</span>}</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the list of dictionaries into a pandas DataFrame</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>event_log_df <span class="op">=</span> pd.DataFrame(event_data)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see what we made! Print the first few rows.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Our Awesome Event Log:"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(event_log_df.head(<span class="dv">10</span>)) <span class="co"># Show first 10 rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code creates our list of event records and then uses <code>pd.DataFrame()</code> to turn it into the table format <code>vidigi</code> loves. We print the first 10 rows using <code>.head(10)</code> to check our work.</p>
<p>Notice how: * Each row has the required columns (<code>patient</code>, <code>event_type</code>, <code>event</code>, <code>time</code>). * The <code>resource_use</code> and <code>resource_use_end</code> events also have <code>resource_id</code> (‘Sim_1’ or ‘Sim_2’). * The entry and exit points use the mandatory <code>event</code> names <code>'arrival'</code> and <code>'depart'</code> with the <code>event_type</code> ‘arrival_departure’. * Events are recorded chronologically <em>per patient</em>, but the overall log doesn’t strictly need to be sorted by time (though it often helps for readability). <code>vidigi</code> will figure out the sequence.</p>
<p>This <code>event_log_df</code> is exactly what you’d pass into the <code>animate_activity_log</code> function we learned about in Chapter 1!</p>
</section>
<section id="under-the-hood-how-vidigi-uses-the-log" class="level2">
<h2 class="anchored" data-anchor-id="under-the-hood-how-vidigi-uses-the-log">Under the Hood: How <code>vidigi</code> Uses the Log</h2>
<p>The Event Log itself is just data – it’s like the script lying on the table. It doesn’t <em>do</em> anything on its own. Other parts of <code>vidigi</code> read this script to understand the plot.</p>
<p>The main consumer of the <code>event_log</code> is the <a href="../autodoc_v3/05_snapshot_preparation_reshape_for_animations_generate_animation_df_.html"><code>reshape_for_animations</code></a> function (which we’ll explore in detail later). Think of <code>reshape_for_animations</code> as the assistant director reading the script and figuring out who needs to be where for every single “snapshot” in time.</p>
<p>Here’s a simplified idea of what happens when <code>reshape_for_animations</code> gets the <code>event_log</code>:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">sequenceDiagram
    participant EL as Event Log (Data)
    participant RFA as reshape_for_animations
    participant Output as Snapshots (Who is where, when)

    RFA-&gt;&gt;EL: Read all event records
    Note over RFA: For each time point (e.g., every minute):
    RFA-&gt;&gt;EL: Find events that happened *before* this time point for each patient
    RFA-&gt;&gt;EL: Identify the *most recent* event for each patient still in the system
    RFA--&gt;&gt;Output: Record patient's current state (event name) at this time point
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Essentially, <code>reshape_for_animations</code> scans through time. At each step (say, every minute), it looks at the <code>event_log</code> to determine the <em>last</em> thing each active <code>patient</code> did. This tells it whether Maverick is currently ‘waiting_for_simulator’ or ‘start_simulator’ at that specific minute.</p>
<p>Internally (looking at <code>vidigi/prep.py</code>), <code>reshape_for_animations</code> might do things like:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Inside reshape_for_animations (Simplified Concept) ---</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (Input: event_log_df)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the log to easily find start/end times (like 'arrival', 'depart')</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>pivoted_log <span class="op">=</span> event_log_df.pivot_table(...)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through time points (e.g., minute 0, 1, 2...)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> minute <span class="kw">in</span> <span class="bu">range</span>(simulation_duration):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find patients who arrived before 'minute' and haven't departed yet</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    active_patients <span class="op">=</span> find_active_patients(pivoted_log, minute)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the original log for these active patients up to 'minute'</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    relevant_events <span class="op">=</span> event_log_df[</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        (event_log_df[<span class="st">'patient'</span>].isin(active_patients)) <span class="op">&amp;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        (event_log_df[<span class="st">'time'</span>] <span class="op">&lt;=</span> minute)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each active patient, find their *very last* event in relevant_events</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    latest_states <span class="op">=</span> relevant_events.sort_values(<span class="st">'time'</span>).groupby(<span class="st">'patient'</span>).tail(<span class="dv">1</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store these latest states as the snapshot for 'minute'</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... add to list of snapshots ...</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># (Output: A DataFrame where each row is a patient's state at a specific minute)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This process transforms the sequential, event-based log into a state-based log, telling us <em>where</em> everyone is at <em>every moment</em> needed for the animation frames.</p>
</section>
<section id="conclusion-fueling-the-flux-capacitor" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-fueling-the-flux-capacitor">Conclusion: Fueling the Flux Capacitor!</h2>
<p>You’ve now mastered the concept of the <strong>Event Log</strong> – the vital, detailed diary that fuels <code>vidigi</code>’s visualizations. It’s the raw data stream, the script detailing every significant moment for every entity, captured with specific columns like <code>patient</code>, <code>event_type</code>, <code>event</code>, <code>time</code>, and sometimes <code>resource_id</code>. Without a good Event Log, our animation DeLorean can’t even reach 88 miles per hour!</p>
<p>You learned the required structure and how to create a basic one using pandas. This log is the fundamental input passed to <a href="../autodoc_v3/01_animation_facade_animate_activity_log_.html"><code>animate_activity_log</code></a>, which then uses helpers like <a href="../autodoc_v3/05_snapshot_preparation_reshape_for_animations_generate_animation_df_.html"><code>reshape_for_animations</code></a> to process it.</p>
<p>But knowing <em>what</em> happened and <em>when</em> isn’t the whole story. We also need to tell <code>vidigi</code> <em>where</em> on the screen these events should take place. How do we map ‘wait_for_simulator’ or ‘start_simulator’ to actual coordinates? That’s the job of the Layout Configuration!</p>
<p>Engage! Let’s warp to <a href="../autodoc_v3/03_layout_configuration_event_position_df_.html">Chapter 3: Layout Configuration (<code>event_position_df</code>)</a>.</p>
<hr>
<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>