<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>animation_generation_generate_animation_ – Vidigi - Auto Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5d2e30ad26079c1dae90a1fd11eba2b9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../autodoc_v3/index.html">Beginner Friendly + 1980s References</a></li><li class="breadcrumb-item"><a href="../autodoc_v3/06_animation_generation_generate_animation_.html">Chapter 6: Action! Making the Movie with <code>generate_animation</code></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Vidigi - Auto Documentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Version 1 - Beginner-Friendly</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial: vidigi</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_animation_facade_animate_activity_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Animation Facade (<code>animate_activity_log</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_event_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Event Log</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_layout_configuration_event_position_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Layout Configuration (<code>event_position_df</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_simpy_resource_enhancement_customresource_store_populate_store_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: Simpy Resource Enhancement (<code>CustomResource</code>, <code>Store</code>, <code>populate_store</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_snapshot_preparation_reshape_for_animations_generate_animation_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Snapshot Preparation (`reshape_for_animations` &amp; `generate_animation_df`)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_animation_generation_generate_animation_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6: Animation Generation (<code>generate_animation</code>)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Version 2 - Intermediate Programmer</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial: vidigi</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/01_animation_facade_animate_activity_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Animation Facade (<code>animate_activity_log</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/02_event_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Event Log</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/03_layout_configuration_event_position_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Layout Configuration (<code>event_position_df</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/04_simpy_resource_enhancement_customresource_store_populate_store_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: Simpy Resource Enhancement (<code>CustomResource</code>, <code>Store</code>, <code>populate_store</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/05_snapshot_preparation_reshape_for_animations_generate_animation_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Snapshot Preparation (`reshape_for_animations` &amp; `generate_animation_df`)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v2/06_animation_generation_generate_animation_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6: Animation Generation (<code>generate_animation</code>)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Beginner Friendly + 1980s References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial: vidigi</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/01_animation_facade_animate_activity_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Great Scott! Making Animations Easy with <code>animate_activity_log</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/02_event_log_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Log Everything! Like K.I.T.T.’s Mission Recorder</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/03_layout_configuration_event_position_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Where Am I? Mapping the Grid with <code>event_position_df</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/04_simpy_resource_enhancement_customresource_store_populate_store_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: More Input! Giving Your Resources an Upgrade (<code>CustomResource</code>, <code>Store</code>, <code>populate_store</code>)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/05_snapshot_preparation_reshape_for_animations_generate_animation_df_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Prepare for Snapshots, McFly! (`reshape_for_animations` &amp; `generate_animation_df`)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../autodoc_v3/06_animation_generation_generate_animation_.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chapter 6: Action! Making the Movie with <code>generate_animation</code></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chapter-6-action-making-the-movie-with-generate_animation" id="toc-chapter-6-action-making-the-movie-with-generate_animation" class="nav-link active" data-scroll-target="#chapter-6-action-making-the-movie-with-generate_animation">Chapter 6: Action! Making the Movie with <code>generate_animation</code></a>
  <ul class="collapse">
  <li><a href="#the-mission-rolling-film" id="toc-the-mission-rolling-film" class="nav-link" data-scroll-target="#the-mission-rolling-film">The Mission: Rolling Film!</a></li>
  <li><a href="#the-projector-how-generate_animation-works" id="toc-the-projector-how-generate_animation-works" class="nav-link" data-scroll-target="#the-projector-how-generate_animation-works">The Projector: How <code>generate_animation</code> Works</a></li>
  <li><a href="#using-the-projector-code-example" id="toc-using-the-projector-code-example" class="nav-link" data-scroll-target="#using-the-projector-code-example">Using the Projector: Code Example</a></li>
  <li><a href="#under-the-hood-inside-the-projection-booth" id="toc-under-the-hood-inside-the-projection-booth" class="nav-link" data-scroll-target="#under-the-hood-inside-the-projection-booth">Under the Hood: Inside the Projection Booth</a></li>
  <li><a href="#conclusion-thats-a-wrap" id="toc-conclusion-thats-a-wrap" class="nav-link" data-scroll-target="#conclusion-thats-a-wrap">Conclusion: That’s a Wrap!</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../autodoc_v3/index.html">Beginner Friendly + 1980s References</a></li><li class="breadcrumb-item"><a href="../autodoc_v3/06_animation_generation_generate_animation_.html">Chapter 6: Action! Making the Movie with <code>generate_animation</code></a></li></ol></nav></header>




<section id="chapter-6-action-making-the-movie-with-generate_animation" class="level1">
<h1>Chapter 6: Action! Making the Movie with <code>generate_animation</code></h1>
<p>Great Scott! In <a href="../autodoc_v3/05_snapshot_preparation_reshape_for_animations_generate_animation_df_.html">Chapter 5: Prepare for Snapshots, McFly! (<code>reshape_for_animations</code> &amp; <code>generate_animation_df</code>)</a>, we saw how <code>vidigi</code> acts like a skilled film crew, taking our raw <a href="../autodoc_v3/02_event_log_.html">Event Log</a> (the script) and turning it into a detailed storyboard (<code>full_patient_df_plus_pos</code>). This storyboard tells us exactly <em>who</em> (Maverick, Goose) is doing <em>what</em> (‘wait_for_simulator’, ‘start_simulator’), <em>when</em> (minute 10, 15, etc.), and precisely <em>where</em> on the screen (‘x_final’, ‘y_final’) they should be, complete with their assigned icon (like giving Johnny 5 his signature look!).</p>
<p>But a storyboard isn’t a movie! We need to actually <em>project</em> these frames onto the screen, make them move smoothly, add the background scenery, and get the VCR (or maybe the Betamax?) rolling. We need the final rendering engine, the movie projector, the director yelling “Action!”</p>
<p>That’s the role of the <code>generate_animation</code> function! It takes the perfectly prepared snapshot data and uses the power of Plotly Express (think of it as the special effects department, maybe ILM back in the 80s) to create the final, interactive animation. It’s time to bring your data to life!</p>
<section id="the-mission-rolling-film" class="level2">
<h2 class="anchored" data-anchor-id="the-mission-rolling-film">The Mission: Rolling Film!</h2>
<p>Our mission, should we choose to accept it, is to take the <code>full_patient_df_plus_pos</code> DataFrame – our meticulously prepared sequence of snapshots with precise coordinates – and turn it into a slick, animated visualization. We want to see Maverick and Goose (represented by cool 80s-style emoji icons, naturally) move through the ‘Hangar Deck’, queue in the ‘Ready Room’, use the ‘Simulator Bays’, and finally head to ‘Debriefing’, all smoothly animated over time with a playable timeline. Cue the <em>Top Gun</em> theme!</p>
</section>
<section id="the-projector-how-generate_animation-works" class="level2">
<h2 class="anchored" data-anchor-id="the-projector-how-generate_animation-works">The Projector: How <code>generate_animation</code> Works</h2>
<p>Think of <code>generate_animation</code> as the high-tech projector in the back of the cinema. It knows how to take the film reel (<code>full_patient_df_plus_pos</code>) and display it frame by frame, creating the illusion of motion.</p>
<p>Its core mechanism relies on <code>plotly.express.scatter</code>:</p>
<ol type="1">
<li><strong>Input Data:</strong> It receives the <code>full_patient_df_plus_pos</code> DataFrame, which has columns like <code>minute</code> (or <code>minute_display</code> for formatted time), <code>patient</code>, <code>x_final</code>, <code>y_final</code>, and <code>icon</code>. This is the complete set of instructions for where each actor (icon) should be in every frame (minute).</li>
<li><strong>Plotly Magic:</strong> It calls <code>plotly.express.scatter</code>, telling it:
<ul>
<li>Use <code>x_final</code> and <code>y_final</code> for the position of each point.</li>
<li>Use <code>icon</code> as the text label for each point (making the points themselves invisible, so we only see the emoji!).</li>
<li>Use <code>minute_display</code> as the <code>animation_frame</code>. This tells Plotly to create a separate frame for each unique value in this column and add a slider to control time.</li>
<li>Use <code>patient</code> as the <code>animation_group</code>. This tells Plotly that rows with the same <code>patient</code> ID across different frames represent the <em>same object</em> moving, allowing Plotly to create smooth transitions between positions. It’s like telling the computer that the ‘Maverick’ icon in frame 10 is the same dude as the ‘Maverick’ icon in frame 11, just potentially in a different spot.</li>
</ul></li>
<li><strong>Adding Static Layers:</strong> After Plotly creates the basic animated scatter plot, <code>generate_animation</code> adds extra, non-moving elements:
<ul>
<li><strong>Stage Labels:</strong> If <code>display_stage_labels=True</code>, it adds text labels (from the <a href="../autodoc_v3/03_layout_configuration_event_position_df_.html">Layout Configuration (<code>event_position_df</code>)</a>) at the specified base coordinates, like putting up signs for “Hangar Deck” or “Simulator Bays”.</li>
<li><strong>Resource Placeholders:</strong> If a <code>scenario</code> object is provided, it uses the resource counts (e.g., <code>g.n_simulators</code>) and the layout information to draw placeholder icons (often light blue circles, but customizable!) for <em>all</em> available resource slots (like ‘Sim_1’, ‘Sim_2’). This lets you see empty bays waiting for pilots. It’s like showing the empty parking spots in the FLAG Mobile Unit for K.I.T.T. and K.A.R.R.</li>
<li><strong>Background Image:</strong> If you provide <code>add_background_image</code>, it stretches your image across the plot area, like projecting a cool background matte painting from <em>Labyrinth</em> or the digital grid from <em>Tron</em>.</li>
</ul></li>
<li><strong>Final Touches:</strong> It configures the plot’s appearance (hiding axes, setting height/width, adjusting animation speed) and returns the final Plotly Figure object.</li>
</ol>
</section>
<section id="using-the-projector-code-example" class="level2">
<h2 class="anchored" data-anchor-id="using-the-projector-code-example">Using the Projector: Code Example</h2>
<p>You usually won’t call <code>generate_animation</code> directly. The main <a href="../autodoc_v3/01_animation_facade_animate_activity_log_.html"><code>animate_activity_log</code></a> function calls it for you after preparing the data with <code>reshape_for_animations</code> and <code>generate_animation_df</code>. However, understanding its signature helps you know what customization options are passed through.</p>
<p>Here’s a conceptual call, assuming <code>data_ready_for_animation</code> (the output from <code>generate_animation_df</code>) and <code>layout_df</code> (our <code>event_position_df</code>) exist:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> vidigi.animation <span class="im">import</span> generate_animation <span class="co"># Import the function</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume 'data_ready_for_animation' DataFrame exists (output of generate_animation_df)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume 'layout_df' DataFrame exists (our event_position_df)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume 'g' scenario object exists with g.n_simulators = 2</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- This function is usually called internally by animate_activity_log ---</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>final_figure <span class="op">=</span> generate_animation(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    full_patient_df_plus_pos<span class="op">=</span>data_ready_for_animation, <span class="co"># The movie reel</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    event_position_df<span class="op">=</span>layout_df, <span class="co"># Needed for labels/resource positions</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    scenario<span class="op">=</span>g, <span class="co"># Needed for resource placeholders</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    plotly_height<span class="op">=</span><span class="dv">600</span>, <span class="co"># Make the screen shorter</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    icon_and_text_size<span class="op">=</span><span class="dv">30</span>, <span class="co"># Bigger icons! RADICAL!</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    display_stage_labels<span class="op">=</span><span class="va">True</span>, <span class="co"># Show "Simulator Bays" etc.</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    add_background_image<span class="op">=</span><span class="st">"path/to/your/awesome_grid.png"</span>, <span class="co"># Optional Tron background</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    frame_duration<span class="op">=</span><span class="dv">500</span>, <span class="co"># Slow down the frames a bit (milliseconds)</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    frame_transition_duration<span class="op">=</span><span class="dv">500</span> <span class="co"># Smoother transitions</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># If you called it directly, you'd show it like this:</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># final_figure.show() # Uncomment to display!</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Plotly Figure generated! Ready to rock and roll!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This call tells <code>generate_animation</code> to take the prepared data, use the layout for context, show resource placeholders based on the <code>scenario</code>, customize the appearance, and return the finished Plotly Figure object, ready to be displayed.</p>
</section>
<section id="under-the-hood-inside-the-projection-booth" class="level2">
<h2 class="anchored" data-anchor-id="under-the-hood-inside-the-projection-booth">Under the Hood: Inside the Projection Booth</h2>
<p>Let’s peek inside <code>generate_animation</code> without needing K.I.T.T.’s X-ray scanner.</p>
<p><strong>Step-by-Step:</strong></p>
<ol type="1">
<li><strong>Receive Inputs:</strong> Gets the prepared data (<code>full_patient_df_plus_pos</code>), layout (<code>event_position_df</code>), scenario, and all the customization parameters.</li>
<li><strong>Calculate Boundaries:</strong> Determines the X and Y axis ranges for the plot based on the layout or overrides.</li>
<li><strong>Format Time:</strong> If <code>time_display_units</code> is set (e.g., ‘dhm’), it converts the raw <code>minute</code> numbers into nicely formatted date/time strings for the animation slider, storing them in <code>minute_display</code>. It keeps the original <code>minute</code> column for sorting. It’s like adding subtitles to the film.</li>
<li><strong>Core Animation (<code>px.scatter</code>):</strong> This is the main event! It calls <code>plotly.express.scatter</code>, passing the prepared data and mapping columns:
<ul>
<li><code>x="x_final"</code></li>
<li><code>y="y_final"</code></li>
<li><code>animation_frame="minute_display"</code></li>
<li><code>animation_group="patient"</code></li>
<li><code>text="icon"</code> (with <code>opacity=0</code> for the underlying marker)</li>
<li><code>hover_name</code>, <code>hover_data</code> for interactivity. Plotly Express does the heavy lifting here, creating the base figure with animated points and the time slider. It’s like the core rendering engine turning vectors into pixels on the Tron grid.</li>
</ul></li>
<li><strong>Add Stage Labels (<code>go.Scatter</code>):</strong> If enabled, it iterates through the <code>event_position_df</code> and adds a <em>static</em> <code>go.Scatter</code> trace with <code>mode="text"</code> to display the <code>label</code> at the base <code>x</code>, <code>y</code> coordinates.</li>
<li><strong>Add Resource Placeholders (<code>go.Scatter</code>):</strong> If a <code>scenario</code> is provided, it calculates the positions for all resource slots (using the base <code>x</code>, <code>y</code> from the layout, <code>gap_between_resources</code>, <code>gap_between_rows</code>, and <code>wrap_resources_at</code>). It then adds another <em>static</em> <code>go.Scatter</code> trace (either <code>mode="markers"</code> for default circles or <code>mode="markers+text"</code> if <code>custom_resource_icon</code> is used) to show these placeholders. It’s like drawing the empty docking bays on Red Dwarf’s status screen.</li>
<li><strong>Add Background (<code>add_layout_image</code>):</strong> If an image path is provided, it adds the image to the layout, stretched to fit the plot area.</li>
<li><strong>Configure Layout:</strong> Updates the figure’s layout: sets height/width, hides axes and gridlines (unless <code>setup_mode=True</code>), ensures the play button is configured (or removed), and sets the animation frame/transition durations (<code>frame_duration</code>, <code>frame_transition_duration</code>).</li>
<li><strong>Return Figure:</strong> Returns the fully constructed and configured <code>plotly.graph_objs.Figure</code> object.</li>
</ol>
<p><strong>Sequence Diagram:</strong></p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">sequenceDiagram
    participant Caller as Your Code / animate_activity_log
    participant GA as generate_animation
    participant DataIn as data_with_positions (DataFrame)
    participant Layout as event_position_df (DataFrame)
    participant Scenario as Scenario Object
    participant PlotlyEx as Plotly Express
    participant PlotlyGO as Plotly Graph Objects
    participant PlotlyFig as Plotly Figure Output

    Caller-&gt;&gt;GA: Call(data_with_positions, layout, scenario, ...)
    GA-&gt;&gt;DataIn: Read positions, icons, minute
    GA-&gt;&gt;Layout: Read base positions, labels
    GA-&gt;&gt;Scenario: Read resource counts (if provided)
    GA-&gt;&gt;PlotlyEx: px.scatter(DataIn, animation_frame='minute_display', ...)
    PlotlyEx--&gt;&gt;GA: Return base animated Figure
    alt display_stage_labels is True
        GA-&gt;&gt;PlotlyGO: fig.add_trace(go.Scatter(mode='text', ...))
    end
    alt scenario is not None
        GA-&gt;&gt;PlotlyGO: fig.add_trace(go.Scatter(mode='markers', ...)) # Resource placeholders
    end
    alt add_background_image is not None
        GA-&gt;&gt;PlotlyFig: fig.add_layout_image(...)
    end
    GA-&gt;&gt;PlotlyFig: fig.update_layout(axes, speed, ...)
    PlotlyFig--&gt;&gt;GA: Return configured Figure
    GA--&gt;&gt;Caller: Return final_figure
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p><strong>Code Snippets (Simplified from <code>vidigi/animation.py</code>):</strong></p>
<p>The core animation command:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Inside generate_animation (Simplified) ---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (Assume data_ready_for_animation has columns:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  'x_final', 'y_final', 'minute_display', 'patient', 'icon', 'event', ...)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    data_ready_for_animation.sort_values(<span class="st">'minute'</span>), <span class="co"># Sort by time!</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"x_final"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"y_final"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    animation_frame<span class="op">=</span><span class="st">"minute_display"</span>, <span class="co"># Tells Plotly how to make frames</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    animation_group<span class="op">=</span><span class="st">"patient"</span>,       <span class="co"># Tells Plotly how to connect dots</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">"icon"</span>,                    <span class="co"># Display the emoji icon</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    hover_name<span class="op">=</span><span class="st">"event"</span>,             <span class="co"># Show event name on hover</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... other parameters like hover_data, ranges, height ...</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    opacity<span class="op">=</span><span class="dv">0</span>                       <span class="co"># Make the underlying point invisible</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Status: Base animation created! Like the raw footage.</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># --- End Snippet ---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This single call creates the moving emojis and the time slider. Everything else builds on this foundation.</p>
<p>Adding static stage labels:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Inside generate_animation (Simplified) ---</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (Assume 'layout_df' has columns 'x', 'y', 'label')</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> display_stage_labels:</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatter(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>layout_df[<span class="st">'x'</span>], <span class="co"># Base X coordinates</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>layout_df[<span class="st">'y'</span>], <span class="co"># Base Y coordinates</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"text"</span>,     <span class="co"># We just want text, no markers</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">""</span>,         <span class="co"># No legend entry needed</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>layout_df[<span class="st">'label'</span>], <span class="co"># The labels to display</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        textposition<span class="op">=</span><span class="st">"middle right"</span>, <span class="co"># Position relative to x,y</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        hoverinfo<span class="op">=</span><span class="st">'none'</span> <span class="co"># Don't show hover info for labels</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Status: Added signs like "Welcome to Hill Valley".</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --- End Snippet ---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Adding static resource placeholder icons:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Inside generate_animation (Simplified) ---</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (Assume 'events_with_resources' DataFrame is calculated with columns:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  'x_final', 'y_final' for each resource slot position)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> scenario <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (Calculation of 'events_with_resources' positions omitted for brevity)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... calculates x_final, y_final for each resource slot ...</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatter(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>events_with_resources[<span class="st">'x_final'</span>],</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>[i <span class="op">-</span> <span class="dv">10</span> <span class="cf">for</span> i <span class="kw">in</span> events_with_resources[<span class="st">'y_final'</span>]], <span class="co"># Slightly offset Y</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"markers"</span>, <span class="co"># Draw markers (default: circles)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'LightSkyBlue'</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            size<span class="op">=</span><span class="dv">15</span>), <span class="co"># Appearance of markers</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        opacity<span class="op">=</span>resource_opacity, <span class="co"># Make them semi-transparent</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        hoverinfo<span class="op">=</span><span class="st">'none'</span> <span class="co"># No hover needed</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Status: Added placeholders for empty simulator bays. Number 5 is... available!</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># --- End Snippet ---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Adding the background image:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Inside generate_animation (Simplified) ---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (Assume 'add_background_image' holds the file path string)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> add_background_image <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    fig.add_layout_image(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">dict</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            source<span class="op">=</span>add_background_image, <span class="co"># Path to the image file</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            xref<span class="op">=</span><span class="st">"x domain"</span>, yref<span class="op">=</span><span class="st">"y domain"</span>, <span class="co"># Stretch across axes</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="dv">1</span>, y<span class="op">=</span><span class="dv">1</span>, sizex<span class="op">=</span><span class="dv">1</span>, sizey<span class="op">=</span><span class="dv">1</span>, <span class="co"># Cover the whole area</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            xanchor<span class="op">=</span><span class="st">"right"</span>, yanchor<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            sizing<span class="op">=</span><span class="st">"stretch"</span>, <span class="co"># Stretch to fit</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            opacity<span class="op">=</span><span class="fl">0.5</span>,      <span class="co"># Make it slightly transparent</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            layer<span class="op">=</span><span class="st">"below"</span>     <span class="co"># Draw it underneath everything else</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Status: Laid down the background, maybe the entrance to Jareth's Labyrinth!</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># --- End Snippet ---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These snippets show how <code>generate_animation</code> builds the final plot layer by layer, starting with the core animation from Plotly Express and adding static elements using Plotly Graph Objects.</p>
</section>
<section id="conclusion-thats-a-wrap" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-thats-a-wrap">Conclusion: That’s a Wrap!</h2>
<p>You’ve reached the end of the production line! <code>generate_animation</code> is the final function in the <code>vidigi</code> animation pipeline, the projector that takes the meticulously prepared snapshot data (<code>full_patient_df_plus_pos</code>) and renders it into a dynamic, interactive Plotly animation. It leverages Plotly Express for the core animation and adds essential static layers like stage labels, resource placeholders, and background images.</p>
<p>This function, along with its partners <code>reshape_for_animations</code> and <code>generate_animation_df</code>, does the heavy lifting behind the scenes when you call the main <a href="../autodoc_v3/01_animation_facade_animate_activity_log_.html"><code>animate_activity_log</code></a> function. Together, they turn your raw simulation <a href="../autodoc_v3/02_event_log_.html">Event Log</a> and <a href="../autodoc_v3/03_layout_configuration_event_position_df_.html">Layout Configuration (<code>event_position_df</code>)</a> into a visual story, letting you see your process unfold like never before – hopefully without disrupting the space-time continuum!</p>
<p>You now understand the key components and the flow of data required to create <code>vidigi</code> animations. Go forth and visualize your processes – make them totally awesome, to the max!</p>
<hr>
<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>