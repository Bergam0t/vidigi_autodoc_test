<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>layout_configuration___event_position_df_ – Vidigi - Auto Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ddd961a2510921635943dfbbd19534c4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Vidigi - Auto Documentation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
<span class="menu-text">Home</span></a>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modules" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Modules</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modules">
        <li>
    <a class="dropdown-item" href="./01_animation_facade_animate_activity_log_.qmd">
 <span class="dropdown-text">Animation Facade (animate_activity_log)</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="./02_event_log_.html">
 <span class="dropdown-text">Event Log</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="./03_layout_configuration_event_position_df_.qmd">
 <span class="dropdown-text">Layout Configuration (event_position_df)</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="./04_simpy_resource_enhancement_customresource_store_populate_store_.qmd">
 <span class="dropdown-text">SimPy Resource Enhancement (CustomResource, Store, populate_store)</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="./05_snapshot_preparation_reshape_for_animations_generate_animation_df_.qmd">
 <span class="dropdown-text">Snapshot Preparation (reshape_for_animations / generate_animation_df)</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="./06_animation_generation_generate_animation_.qmd">
 <span class="dropdown-text">Animation Generation (generate_animation)</span></a>
  </li>
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>

  <ul>
  <li><a href="#chapter-3-layout-configuration-event_position_df" id="toc-chapter-3-layout-configuration-event_position_df" class="nav-link active" data-scroll-target="#chapter-3-layout-configuration-event_position_df">Chapter 3: Layout Configuration (<code>event_position_df</code>)</a>
  <ul class="collapse">
  <li><a href="#setting-the-stage-why-we-need-a-layout" id="toc-setting-the-stage-why-we-need-a-layout" class="nav-link" data-scroll-target="#setting-the-stage-why-we-need-a-layout">Setting the Stage: Why We Need a Layout</a></li>
  <li><a href="#what-does-the-layout-blueprint-look-like" id="toc-what-does-the-layout-blueprint-look-like" class="nav-link" data-scroll-target="#what-does-the-layout-blueprint-look-like">What Does the Layout Blueprint Look Like?</a></li>
  <li><a href="#a-simple-blueprint-example" id="toc-a-simple-blueprint-example" class="nav-link" data-scroll-target="#a-simple-blueprint-example">A Simple Blueprint Example</a></li>
  <li><a href="#using-the-blueprint" id="toc-using-the-blueprint" class="nav-link" data-scroll-target="#using-the-blueprint">Using the Blueprint</a></li>
  <li><a href="#how-vidigi-reads-the-blueprint-under-the-hood" id="toc-how-vidigi-reads-the-blueprint-under-the-hood" class="nav-link" data-scroll-target="#how-vidigi-reads-the-blueprint-under-the-hood">How <code>vidigi</code> Reads the Blueprint (Under the Hood)</a></li>
  <li><a href="#tips-for-setting-up-your-layout" id="toc-tips-for-setting-up-your-layout" class="nav-link" data-scroll-target="#tips-for-setting-up-your-layout">Tips for Setting Up Your Layout</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="chapter-3-layout-configuration-event_position_df" class="level1">
<h1>Chapter 3: Layout Configuration (<code>event_position_df</code>)</h1>
<p>In <a href="./02_event_log_.html">Chapter 2: Event Log</a>, we learned about the <code>event_log</code>, which is like the detailed script telling <code>vidigi</code> <em>what</em> happened, <em>when</em>, and to <em>whom</em>. But just knowing the script isn’t enough to make a movie – you also need to know where the scenes take place! Where is the entrance? Where’s the waiting area? Where are the treatment rooms located on the screen?</p>
<p>That’s where the <strong>Layout Configuration</strong>, represented by the <code>event_position_df</code> DataFrame, comes in. It’s the <strong>blueprint</strong> or <strong>map</strong> for your animation’s background.</p>
<section id="setting-the-stage-why-we-need-a-layout" class="level2">
<h2 class="anchored" data-anchor-id="setting-the-stage-why-we-need-a-layout">Setting the Stage: Why We Need a Layout</h2>
<p>Imagine you’re setting up a stage play. You need to decide: * Where will actors enter? (Stage Left) * Where is the waiting bench? (Center Stage) * Where is the doctor’s office set piece? (Stage Right)</p>
<p>Without this plan, the actors wouldn’t know where to go, and the audience would be confused.</p>
<p>Similarly, <code>vidigi</code> needs a map to know where to place the icons representing your patients or entities on the screen. The <code>event_position_df</code> provides exactly this map. For every key step (event) in your process, it defines a specific <strong>(X, Y) coordinate</strong> on the animation screen.</p>
</section>
<section id="what-does-the-layout-blueprint-look-like" class="level2">
<h2 class="anchored" data-anchor-id="what-does-the-layout-blueprint-look-like">What Does the Layout Blueprint Look Like?</h2>
<p>The <code>event_position_df</code> is typically a <code>pandas</code> DataFrame – essentially a table. Each row in this table describes a specific location or stage in your process.</p>
<p>Here are the essential columns you need in this table:</p>
<ul>
<li><strong><code>event</code></strong>: This column contains the <em>exact name</em> of the event from your <a href="./02_event_log_.html">Event Log</a> that corresponds to this location. For example, <code>'arrival'</code>, <code>'start_wait'</code>, <code>'treatment_begins'</code>. This is how <code>vidigi</code> links the location map to the event script.</li>
<li><strong><code>x</code></strong>: The horizontal coordinate (position from left to right) for this event’s base location on the screen.</li>
<li><strong><code>y</code></strong>: The vertical coordinate (position from top to bottom) for this event’s base location on the screen.</li>
</ul>
<p>Think of the (X, Y) coordinates as <strong>anchor points</strong>. * For <strong>queues</strong> (like <code>'start_wait'</code>), patients will line up extending <em>leftwards</em> from this anchor point. * For <strong>resources</strong> (like <code>'treatment_begins'</code>), the available resource slots (e.g., treatment beds) will be placed near this anchor point, usually extending leftwards too. * For <strong>arrivals</strong> and <strong>departures</strong>, patients will appear or disappear at this exact anchor point.</p>
<p>You’ll often include these helpful optional columns too:</p>
<ul>
<li><strong><code>label</code></strong>: A human-readable name for the stage (like <code>"Arrival Area"</code>, <code>"Waiting Room"</code>, <code>"Treatment Bays"</code>). <code>vidigi</code> can display these labels on the animation to make it easier to understand.</li>
<li><strong><code>resource</code></strong>: This column links events associated with resource usage (like <code>'treatment_begins'</code>) to the <em>name</em> of the resource capacity defined in an external object (often called <code>scenario</code>). For example, if you have an event <code>'treatment_begins'</code> and your <code>scenario</code> object says you have <code>scenario.n_nurses = 5</code> nurses, you would put <code>'n_nurses'</code> in the <code>resource</code> column for the <code>'treatment_begins'</code> row. This tells <code>vidigi</code> how many resource slots to draw and manage for that step.</li>
</ul>
</section>
<section id="a-simple-blueprint-example" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-blueprint-example">A Simple Blueprint Example</h2>
<p>Let’s create a basic <code>event_position_df</code> for the simple clinic example we’ve been using.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the layout DataFrame</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>layout_data <span class="op">=</span> {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'event'</span>: [<span class="st">'arrival'</span>, <span class="st">'start_wait'</span>, <span class="st">'treatment_begins'</span>, <span class="st">'depart'</span>, <span class="st">'exit'</span>], <span class="co"># Must match event names in the log!</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'x'</span>: [<span class="dv">50</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">350</span>, <span class="dv">350</span>],  <span class="co"># Horizontal positions</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'y'</span>: [<span class="dv">200</span>, <span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">150</span>, <span class="dv">50</span>],   <span class="co"># Vertical positions</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'label'</span>: [<span class="st">'Entrance'</span>, <span class="st">'Waiting Area'</span>, <span class="st">'Treatment Bays'</span>, <span class="st">'Discharge'</span>, <span class="st">'Exit Point'</span>], <span class="co"># Human-friendly names</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'resource'</span>: [<span class="va">None</span>, <span class="va">None</span>, <span class="st">'n_cubicles'</span>, <span class="va">None</span>, <span class="va">None</span>] <span class="co"># Link 'treatment_begins' to the number of cubicles</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>my_layout <span class="op">=</span> pd.DataFrame(layout_data)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(my_layout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Output:</strong></p>
<pre><code>              event    x    y             label   resource
0           arrival   50  200          Entrance       None
1        start_wait  200  250      Waiting Area       None
2  treatment_begins  200  150    Treatment Bays n_cubicles  # This step uses 'n_cubicles' resources
3            depart  350  150         Discharge       None
4              exit  350   50        Exit Point       None</code></pre>
<p>Let’s break this down: * <strong>Row 0:</strong> Anyone recorded with the <code>event</code> ‘arrival’ in the log will appear at coordinates (X=50, Y=200). This spot will be labelled “Entrance”. * <strong>Row 1:</strong> When a patient’s <code>event</code> becomes ‘start_wait’, they move towards (X=200, Y=250). If others are already waiting, they’ll queue up extending to the left from this point. This area is labelled “Waiting Area”. * <strong>Row 2:</strong> When a patient’s <code>event</code> is ‘treatment_begins’, they move towards (X=200, Y=150). Because this row has <code>'n_cubicles'</code> in the <code>resource</code> column, <code>vidigi</code> knows this involves using a resource. It will look up how many <code>n_cubicles</code> are available (from the <code>scenario</code> object you provide) and place the patient icon in the correct cubicle slot near (200, 150). This area is labelled “Treatment Bays”. * <strong>Row 3 &amp; 4:</strong> Patients move to (350, 150) for ‘depart’ and finally vanish at the ‘exit’ point (350, 50).</p>
<p><em>(Note: We added an ‘exit’ event here, which wasn’t in the Chapter 2 log but is often added automatically by <code>vidigi</code>’s internal processing to ensure entities cleanly leave the screen).</em></p>
</section>
<section id="using-the-blueprint" class="level2">
<h2 class="anchored" data-anchor-id="using-the-blueprint">Using the Blueprint</h2>
<p>You provide this <code>event_position_df</code> (our <code>my_layout</code> variable) directly to the main <a href="01_animation_facade_animate_activity_log_.qmd"><code>animate_activity_log</code></a> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (Assuming my_event_log and scenario_details from Chapter 1 &amp; 2 exist)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> vidigi.animation <span class="im">import</span> animate_activity_log</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Our layout from above ---</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># my_layout = pd.DataFrame(...)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Pretend we have these ---</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># my_event_log = pd.DataFrame(...) from Chapter 2</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># class SimpleScenario: n_cubicles = 2 # From Chapter 1 layout example</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># scenario_details = SimpleScenario()</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Call the animation function ---</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>my_animation <span class="op">=</span> animate_activity_log(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    event_log<span class="op">=</span>my_event_log,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    event_position_df<span class="op">=</span>my_layout,  <span class="co"># &lt;-- Pass the layout here!</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    scenario<span class="op">=</span>scenario_details,   <span class="co"># &lt;-- Needed for resource counts ('n_cubicles')</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... other options like time_display_units, icon_size etc.</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># my_animation.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When you run this, <code>vidigi</code> uses <code>my_layout</code> to determine where to draw everything. Patients arrive near (50, 200), queue leftwards from (200, 250), occupy one of the (in this case 2) treatment slots near (200, 150), and then depart via (350, 150) and (350, 50).</p>
</section>
<section id="how-vidigi-reads-the-blueprint-under-the-hood" class="level2">
<h2 class="anchored" data-anchor-id="how-vidigi-reads-the-blueprint-under-the-hood">How <code>vidigi</code> Reads the Blueprint (Under the Hood)</h2>
<p>You don’t usually need to worry about the deep internals, but it helps to understand the basics. When <code>animate_activity_log</code> needs to figure out the exact position of every patient at every snapshot in time, it uses a helper function called <a href="05_snapshot_preparation_reshape_for_animations_generate_animation_df_.qmd"><code>generate_animation_df</code></a>.</p>
<p>Here’s a simplified idea of what <code>generate_animation_df</code> does:</p>
<ol type="1">
<li><strong>Get Base Position:</strong> For a patient <code>P</code> whose current <code>event</code> is, say, <code>'start_wait'</code> at time <code>T</code>, it looks up <code>'start_wait'</code> in the <code>event_position_df</code> to find the base coordinates (e.g., X=200, Y=250).</li>
<li><strong>Handle Queues:</strong> If the <code>event_type</code> is <code>'queue'</code>, it checks how many other patients are also in the <code>'start_wait'</code> state at time <code>T</code>. It calculates an offset (usually moving left and wrapping to new rows if needed) from the base (X, Y) based on the patient’s position in the queue.</li>
<li><strong>Handle Resources:</strong> If the <code>event_type</code> is <code>'resource_use'</code> (like <code>'treatment_begins'</code>), it checks the <code>resource</code> column in <code>event_position_df</code> (e.g., <code>'n_cubicles'</code>). It then asks the <code>scenario</code> object, “How many <code>n_cubicles</code> are there?”. It also looks at the patient’s specific <code>resource_id</code> from the event log (e.g., they are using cubicle <code>1</code>). It then calculates the exact position for cubicle <code>1</code> relative to the base (X, Y) for <code>'treatment_begins'</code>.</li>
<li><strong>Assign Final Position:</strong> It stores these calculated (X, Y) coordinates for patient <code>P</code> at time <code>T</code>.</li>
</ol>
<p>This process repeats for every patient at every time snapshot.</p>
<p>Here’s a simplified diagram showing the interaction:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">sequenceDiagram
    participant AAL as animate_activity_log
    participant GAD as generate_animation_df
    participant Layout as event_position_df (The Blueprint)
    participant Log as Event Log
    participant Scenario as scenario object

    AAL-&gt;&gt;GAD: Calculate positions for all patients at all times
    GAD-&gt;&gt;Log: Get patient P's event &amp; resource_id at time T
    GAD-&gt;&gt;Layout: Get base (x, y) &amp; resource name for event
    alt Event is Resource Use
        GAD-&gt;&gt;Scenario: Get total count for resource name
        GAD-&gt;&gt;GAD: Calculate position based on base(x,y), resource_id, total count
    else Event is Queue
        GAD-&gt;&gt;GAD: Calculate queue position offset from base(x,y)
    else Event is Arrival/Depart
        GAD-&gt;&gt;GAD: Use base(x,y) directly
    end
    GAD--&gt;&gt;AAL: Return DataFrame with calculated positions
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="tips-for-setting-up-your-layout" class="level2">
<h2 class="anchored" data-anchor-id="tips-for-setting-up-your-layout">Tips for Setting Up Your Layout</h2>
<ul>
<li><strong>Match Event Names:</strong> The <code>event</code> names in <code>event_position_df</code> <em>must exactly match</em> the <code>event</code> names used in your <code>event_log</code>.</li>
<li><strong>Coordinates are Anchors:</strong> Remember (X, Y) are often the <em>bottom-right</em> anchor for queues and resources, which typically extend leftwards and potentially upwards in rows.</li>
<li><strong>Use <code>setup_mode</code>:</strong> When first creating your layout, pass <code>setup_mode=True</code> to <code>animate_activity_log</code>. This will display grid lines and coordinate axes on the animation, making it much easier to figure out good X and Y values!</li>
<li><strong>Iterate:</strong> Getting the layout perfect often takes a few tries. Run the animation, see how it looks, adjust the X/Y values in your DataFrame, and run it again.</li>
</ul>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The <code>event_position_df</code> is your essential blueprint for the visual layout of your <code>vidigi</code> animation. It’s a simple table (DataFrame) that tells <code>vidigi</code> the base (X, Y) coordinates for each key event, allows you to add descriptive labels, and connects resource-using events to their capacities defined in a <code>scenario</code> object. By carefully crafting this layout, you control where queues form, where resources are located, and how entities move across the screen, turning your raw event data into an understandable visual story.</p>
<p>Now that we understand the <em>script</em> (<code>event_log</code>) and the <em>stage map</em> (<code>event_position_df</code>), we need to look closer at the <em>actors</em> that use specific props – the resources. How does <code>vidigi</code> handle knowing exactly <em>which</em> cubicle or <em>which</em> nurse a patient is using? That involves enhancing how we define and use resources in our simulation model, which is the topic of our next chapter.</p>
<p>Next up: <a href="04_simpy_resource_enhancement___customresource____store____populate_store___.qmd">Chapter 4: Simpy Resource Enhancement (<code>CustomResource</code>, <code>Store</code>, <code>populate_store</code>)</a></p>
<hr>
<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button,
        { trigger: "manual",
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined;
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            }
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          }
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
